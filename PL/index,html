<!-- index.html -->
<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>주식 P/L 계산기 (KR / US)</title>
    <meta name="description" content="한국주식/미국주식 손익(P/L) 계산기. 미국주식은 매수/매도 환율을 분리해 계산합니다." />
    <link rel="stylesheet" href="./styles.css" />
  </head>

  <body>
    <header class="topbar">
      <div class="container">
        <div class="brand">
          <div class="logo" aria-hidden="true">₩$</div>
          <div class="brand-text">
            <h1>주식 P/L 계산기</h1>
            <p>한국주식 · 미국주식 (매수/매도 환율 분리)</p>
          </div>
        </div>
        <div class="topbar-actions">
          <button class="btn btn-ghost" id="btnOpenAbout" type="button" aria-haspopup="dialog">
            사용법
          </button>
        </div>
      </div>
    </header>

    <main class="container">
      <section class="hero">
        <h2>어떤 시장을 계산할까요?</h2>
        <p class="muted">
          아래 카드에서 선택하면 계산 창(팝업)이 열립니다. 미국주식은 <b>매수환율</b>과 <b>매도환율(또는 현재환율)</b>을
          따로 입력하거나 불러올 수 있어요.
        </p>
      </section>

      <section class="grid" aria-label="시장 선택">
        <button class="card" id="cardKR" type="button" aria-haspopup="dialog">
          <div class="card-head">
            <span class="pill">🇰🇷 KR</span>
            <h3>한국주식</h3>
          </div>
          <p class="card-desc">단일 종목 손익, 수수료/세금 반영</p>
          <div class="card-foot">
            <span class="hint">클릭해서 계산기 열기</span>
            <span class="arrow" aria-hidden="true">→</span>
          </div>
        </button>

        <button class="card" id="cardUS" type="button" aria-haspopup="dialog">
          <div class="card-head">
            <span class="pill">🇺🇸 US</span>
            <h3>미국주식</h3>
          </div>
          <p class="card-desc">매수·매도 환율 분리, 원화손익/환차 분리 표시</p>
          <div class="card-foot">
            <span class="hint">클릭해서 계산기 열기</span>
            <span class="arrow" aria-hidden="true">→</span>
          </div>
        </button>
      </section>

      <section class="footer-note">
        <div class="note">
          <b>확장 예정 구조</b>
          <ul>
            <li>거래내역(분할매수/부분매도) 테이블</li>
            <li>다종목 포트폴리오 합산</li>
            <li>환율 자동 불러오기(현재/과거)</li>
          </ul>
        </div>
      </section>
    </main>

    <!-- MODAL: Calculator -->
    <div class="modal-backdrop" id="modalBackdrop" hidden></div>

    <section
      class="modal"
      id="calcModal"
      role="dialog"
      aria-modal="true"
      aria-labelledby="modalTitle"
      hidden
    >
      <div class="modal-header">
        <div>
          <p class="modal-kicker" id="modalKicker">시장 선택</p>
          <h3 class="modal-title" id="modalTitle">계산기</h3>
        </div>
        <button class="icon-btn" id="btnCloseModal" type="button" aria-label="닫기">✕</button>
      </div>

      <div class="modal-body">
        <!-- Market tabs (공용 모달 방식) -->
        <div class="tabs" role="tablist" aria-label="시장 탭">
          <button class="tab" id="tabKR" type="button" role="tab" aria-selected="false">한국주식</button>
          <button class="tab" id="tabUS" type="button" role="tab" aria-selected="false">미국주식</button>
        </div>

        <!-- ====== FORM: KR ====== -->
        <form class="form" id="formKR" autocomplete="off">
          <div class="form-grid">
            <div class="field">
              <label for="krBuyPrice">매수단가 (KRW)</label>
              <input id="krBuyPrice" name="krBuyPrice" inputmode="decimal" placeholder="예: 53000" />
            </div>
            <div class="field">
              <label for="krQty">수량</label>
              <input id="krQty" name="krQty" inputmode="numeric" placeholder="예: 10" />
            </div>
            <div class="field">
              <label for="krNowPrice">현재가/매도단가 (KRW)</label>
              <input id="krNowPrice" name="krNowPrice" inputmode="decimal" placeholder="예: 54800" />
            </div>

            <div class="field">
              <label for="krFeeBuy">매수 수수료 (KRW, 선택)</label>
              <input id="krFeeBuy" name="krFeeBuy" inputmode="decimal" placeholder="예: 1000" />
            </div>
            <div class="field">
              <label for="krFeeSell">매도 수수료 (KRW, 선택)</label>
              <input id="krFeeSell" name="krFeeSell" inputmode="decimal" placeholder="예: 1000" />
            </div>
            <div class="field">
              <label for="krTaxSell">매도 세금 (KRW, 선택)</label>
              <input id="krTaxSell" name="krTaxSell" inputmode="decimal" placeholder="예: 0" />
            </div>
          </div>

          <div class="actions">
            <button class="btn btn-secondary" id="krReset" type="button">초기화</button>
            <button class="btn btn-primary" id="krCalc" type="button">계산하기</button>
          </div>
        </form>

        <!-- ====== FORM: US ====== -->
        <form class="form" id="formUS" autocomplete="off">
          <div class="form-grid">
            <div class="field">
              <label for="usBuyPrice">매수단가 (USD)</label>
              <input id="usBuyPrice" name="usBuyPrice" inputmode="decimal" placeholder="예: 150.25" />
            </div>
            <div class="field">
              <label for="usQty">수량</label>
              <input id="usQty" name="usQty" inputmode="numeric" placeholder="예: 5" />
            </div>
            <div class="field">
              <label for="usNowPrice">현재가/매도단가 (USD)</label>
              <input id="usNowPrice" name="usNowPrice" inputmode="decimal" placeholder="예: 170.10" />
            </div>

            <div class="field">
              <label for="usFeeBuy">매수 수수료 (USD, 선택)</label>
              <input id="usFeeBuy" name="usFeeBuy" inputmode="decimal" placeholder="예: 0" />
            </div>
            <div class="field">
              <label for="usFeeSell">매도 수수료 (USD, 선택)</label>
              <input id="usFeeSell" name="usFeeSell" inputmode="decimal" placeholder="예: 0" />
            </div>

            <div class="field">
              <label for="usFxBuy">매수환율 (KRW/USD)</label>
              <input id="usFxBuy" name="usFxBuy" inputmode="decimal" placeholder="예: 1330.5" />
              <div class="mini-actions">
                <button class="btn btn-mini" id="btnFxBuy" type="button">매수환율 불러오기</button>
              </div>
            </div>

            <div class="field">
              <label for="usFxSell">매도환율 (KRW/USD)</label>
              <input id="usFxSell" name="usFxSell" inputmode="decimal" placeholder="예: 1342.2" />
              <div class="mini-actions">
                <button class="btn btn-mini" id="btnFxSell" type="button">매도/현재환율 불러오기</button>
              </div>
            </div>

            <div class="field field-wide">
              <label class="check">
                <input id="usIsUnrealized" type="checkbox" />
                아직 안 팔았어요(평가손익). <span class="muted">매도환율 칸을 “현재환율”로 사용</span>
              </label>
            </div>
          </div>

          <div class="actions">
            <button class="btn btn-secondary" id="usReset" type="button">초기화</button>
            <button class="btn btn-primary" id="usCalc" type="button">계산하기</button>
          </div>
        </form>

        <!-- ====== RESULTS ====== -->
        <section class="results" aria-live="polite">
          <div class="results-head">
            <h4>결과</h4>
            <p class="muted" id="resultMeta">입력 후 “계산하기”를 누르세요.</p>
          </div>

          <div class="result-grid">
            <div class="result-card">
              <p class="label">총손익</p>
              <p class="value" id="rTotal">-</p>
            </div>
            <div class="result-card">
              <p class="label">손익률</p>
              <p class="value" id="rRate">-</p>
            </div>
            <div class="result-card">
              <p class="label">평균단가</p>
              <p class="value" id="rAvg">-</p>
            </div>
            <div class="result-card">
              <p class="label">평가금액/매도금액</p>
              <p class="value" id="rGross">-</p>
            </div>
          </div>

          <div class="split" id="usSplit" hidden>
            <div class="split-row">
              <span>주가손익(원화)</span>
              <b id="rPricePnL">-</b>
            </div>
            <div class="split-row">
              <span>환차손익(원화)</span>
              <b id="rFxPnL">-</b>
            </div>
            <div class="split-row">
              <span>USD 손익</span>
              <b id="rUsdPnL">-</b>
            </div>
          </div>

          <div class="toast" id="toast" hidden></div>
        </section>
      </div>
    </section>

    <!-- MODAL: About -->
    <section class="modal" id="aboutModal" role="dialog" aria-modal="true" aria-labelledby="aboutTitle" hidden>
      <div class="modal-header">
        <div>
          <p class="modal-kicker">가이드</p>
          <h3 class="modal-title" id="aboutTitle">사용법</h3>
        </div>
        <button class="icon-btn" id="btnCloseAbout" type="button" aria-label="닫기">✕</button>
      </div>
      <div class="modal-body">
        <ol class="guide">
          <li>홈에서 한국/미국 카드를 클릭해 계산기를 여세요.</li>
          <li>미국주식은 매수환율/매도환율을 각각 입력하거나 버튼으로 불러오세요.</li>
          <li>“아직 안 팔았어요” 체크 시, 매도환율은 현재환율로 계산합니다.</li>
        </ol>
        <p class="muted small">
          다음 단계: 거래내역(분할매수/부분매도) 테이블, 다종목 합산, 환율 히스토리 자동 조회.
        </p>
      </div>
    </section>

    <script defer src="./app.js"></script>
  </body>
</html>
