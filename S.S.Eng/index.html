<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Stock Simulator â€” Single File</title>

<style>
:root{
  --bg:#0b0c10; --card:#151821; --muted:#99a3b3; --text:#e9edf3;
  --brand:#5b8cff; --accent:#2ee59d; --danger:#ff4d61;
  --grid:#232634; --border:#222636;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:#0b0c10;
  color:var(--text);
  font-family:system-ui, -apple-system, Segoe UI, sans-serif;
}
.container{max-width:1100px;margin:24px auto;padding:16px}
.card{
  background:#151821;
  border-radius:16px;
  padding:16px;
  margin-bottom:16px;
}
h1,h2{margin:0 0 12px}
button{
  padding:10px 14px;
  border-radius:10px;
  border:none;
  cursor:pointer;
}
.brand{background:#5b8cff;color:white}
.accent{background:#2ee59d}
.danger{background:#ff4d61;color:white}
input,select{
  background:#0f1322;
  border:1px solid #2b3042;
  border-radius:8px;
  padding:8px;
  color:white;
}
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  padding:6px;
  border-bottom:1px solid #2b3042;
  text-align:right;
}
th:first-child,td:first-child{text-align:left}
canvas{width:100%;height:240px}
</style>
</head>

<body>
<div class="container">
  <h1>ğŸ“ˆ Stock Simulator</h1>

  <div class="card">
    <h2>ì£¼ë¬¸</h2>
    <input id="sym" value="AAPL">
    <input id="qty" type="number" value="10">
    <select id="side">
      <option value="buy">Buy</option>
      <option value="sell">Sell</option>
    </select>
    <button id="place" class="brand">ì£¼ë¬¸</button>
    <button id="next" class="accent">ë‹¤ìŒ ë‚ </button>
    <button id="reset" class="danger">ë¦¬ì…‹</button>
  </div>

  <div class="card">
    <h2>ìì‚° ì¶”ì´</h2>
    <canvas id="chart" width="1000" height="240"></canvas>
  </div>

  <div class="card">
    <h2>í¬ì§€ì…˜</h2>
    <table id="pos">
      <thead>
        <tr><th>ì¢…ëª©</th><th>ìˆ˜ëŸ‰</th><th>í‰ê· ê°€</th><th>í˜„ì¬ê°€</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script>
(() => {

const last = arr => arr[arr.length - 1];

const state = {
  cash:100000,
  positions:{},
  prices:{},
  equity:[]
};

function ensureSymbol(sym){
  if(state.prices[sym]) return;
  let px = 100;
  state.prices[sym] = [];
  for(let i=0;i<20;i++){
    px *= 1 + (Math.random()-0.5)*0.04;
    state.prices[sym].push(px);
  }
}

function placeOrder(){
  const sym = document.getElementById('sym').value.toUpperCase();
  const qty = +document.getElementById('qty').value;
  const side = document.getElementById('side').value;
  ensureSymbol(sym);

  const price = last(state.prices[sym]);
  const cost = price * qty;

  if(side==='buy'){
    if(state.cash < cost) return alert('í˜„ê¸ˆ ë¶€ì¡±');
    state.cash -= cost;
    const p = state.positions[sym] || {qty:0,avg:0};
    p.avg = (p.avg*p.qty + price*qty)/(p.qty+qty);
    p.qty += qty;
    state.positions[sym] = p;
  }else{
    const p = state.positions[sym];
    if(!p || p.qty < qty) return alert('ë³´ìœ  ë¶€ì¡±');
    p.qty -= qty;
    state.cash += cost;
  }
  render();
}

function nextDay(){
  for(const s in state.prices){
    let px = last(state.prices[s]);
    px *= 1 + (Math.random()-0.5)*0.04;
    state.prices[s].push(px);
  }
  render();
}

function render(){
  const tbody = document.querySelector('#pos tbody');
  tbody.innerHTML='';
  for(const s in state.positions){
    const p = state.positions[s];
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${s}</td>
      <td>${p.qty}</td>
      <td>${p.avg.toFixed(2)}</td>
      <td>${last(state.prices[s]).toFixed(2)}</td>
    `;
    tbody.appendChild(tr);
  }
  drawChart();
}

function drawChart(){
  const c = document.getElementById('chart');
  const ctx = c.getContext('2d');
  ctx.clearRect(0,0,c.width,c.height);
  const eq = [];
  let v = state.cash;
  for(const s in state.positions){
    v += state.positions[s].qty * last(state.prices[s]);
  }
  eq.push(v);
  ctx.beginPath();
  ctx.moveTo(0,200);
  ctx.lineTo(1000,200-v/1000);
  ctx.strokeStyle='#5b8cff';
  ctx.stroke();
}

document.getElementById('place').onclick = placeOrder;
document.getElementById('next').onclick = nextDay;
document.getElementById('reset').onclick = () => location.reload();

})();
</script>
</body>
</html>
