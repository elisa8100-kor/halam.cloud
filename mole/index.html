<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>LOCKED GAME</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
  body {
    margin: 0;
    background: #111;
    color: #fff;
    font-family: Arial, sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }

  #game {
    text-align: center;
  }

  canvas {
    background: #000;
    border: 3px solid #555;
  }

  #lockScreen {
    position: fixed;
    inset: 0;
    background: black;
    color: white;
    display: none;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    z-index: 9999;
  }
</style>
</head>

<body>

<div id="lockScreen">ğŸ”’ í˜„ì¬ ì‚¬ì´íŠ¸ê°€ ì ê²¨ ìˆìŠµë‹ˆë‹¤</div>

<div id="game">
  <h1>ê²Œì„ í™”ë©´</h1>
  <canvas id="canvas" width="300" height="300"></canvas>
  <p>ë°©í–¥í‚¤ë¡œ ì›€ì§ì´ì„¸ìš”</p>
</div>

<script type="module">
/* =========================
   ğŸ” Firebase ì ê¸ˆ ì‹œìŠ¤í…œ
========================= */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBlhU1NVqceV0zYtgSaDF1Q22DebLVlT7E",
  authDomain: "mole-71eed.firebaseapp.com",
  projectId: "mole-71eed",
  storageBucket: "mole-71eed.appspot.com",
  messagingSenderId: "770752185372",
  appId: "1:770752185372:web:44c462f2021f6752750bd9"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const lockRef = doc(db, "site", "lock");
const lockScreen = document.getElementById("lockScreen");
const gameDiv = document.getElementById("game");

let isLocked = false;

onSnapshot(lockRef, (snap) => {
  if (snap.exists() && snap.data().locked === true) {
    isLocked = true;
    lockScreen.style.display = "flex";
    gameDiv.style.display = "none";
  } else {
    isLocked = false;
    lockScreen.style.display = "none";
    gameDiv.style.display = "block";
    requestAnimationFrame(gameLoop);
  }
});

/* =========================
   ğŸ® ê²Œì„ ë¡œì§
========================= */
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let x = 140;
let y = 140;
const size = 20;
const speed = 4;

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = "lime";
  ctx.fillRect(x, y, size, size);
}

function gameLoop() {
  if (isLocked) return;
  draw();
  requestAnimationFrame(gameLoop);
}

document.addEventListener("keydown", (e) => {
  if (isLocked) return;

  if (e.key === "ArrowUp") y -= speed;
  if (e.key === "ArrowDown") y += speed;
  if (e.key === "ArrowLeft") x -= speed;
  if (e.key === "ArrowRight") x += speed;

  x = Math.max(0, Math.min(280, x));
  y = Math.max(0, Math.min(280, y));
});

gameLoop();
</script>

</body>
</html>
